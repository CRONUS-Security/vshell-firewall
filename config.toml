# vshell-firewall 配置文件
# 支持 HTTP 和 TCP 处理器管道

# 全局配置
[global]
buffer_size = 32768  # 缓冲区大小 (字节)
log_level = "info"   # 日志级别: debug, info, warn, error

# 监听端口配置 - 可以配置多个
[[listeners]]
name = "http_proxy"              # 监听器名称
listen_port = ":8081"            # 监听端口
backend_addr = "127.0.0.1:8080"  # 后端地址
protocol = "tcp"                 # 后端协议类型: tcp

# 超时配置
[listeners.timeout]
enabled = false                  # 是否启用超时
initial_read = 30                # 初始读取超时 (秒)，0 表示无限制
connect_backend = 5              # 连接后端超时 (秒)，0 表示无限制

# HTTP 处理器管道 - 按顺序匹配处理
[[listeners.http.processor]]
path = "/patch_slt"
match_mode = "prefix"
action = "rewrite"               # 路径重写
rewrite_to = "/slt"

[[listeners.http.processor]]
path = "/patch_swt"
match_mode = "prefix"
action = "rewrite"
rewrite_to = "/swt"

[[listeners.http.processor]]
path = "/admin"
match_mode = "prefix"
action = "allow"                 # 允许转发到后端

[[listeners.http.processor]]
path = "/"                     # 匹配剩下的所有 HTTP 请求
action = "file"                  # 返回文件内容
file = "./index.html"

# TCP 处理器 - 允许非 HTTP 的 TCP 连接
[[listeners.tcp.processor]]
action = "allow"


# 第二个监听器示例 - 纯 TCP 转发，无超时限制
[[listeners]]
name = "tcp_longconn"
listen_port = ":9880"
backend_addr = "127.0.0.1:9992"
protocol = "tcp"                 # TCP 协议

[listeners.timeout]
enabled = false                  # 禁用超时，适合长连接

# TCP 处理器 - 允许所有 TCP 连接
[[listeners.tcp.processor]]
action = "allow"                 # 转发到后端
